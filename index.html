<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#099999">
    <title>Ø±Ù…Ø¶Ø§Ù† 2026 ÙˆÙˆÙØ±Ø¯ Ø§Ù„Ù†Ø´Ø§Ù…Ù‰ - Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.4.3/lib/bundles/adhan.umd.min.js" defer></script>

    <style>
        /* === Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† === */
        :root {
            --brand-primary: #099999;
            --accent-gold: #fbbf24;
            --success-color: #10b981;
            --danger-color: #ef4444;
            
            /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ) */
            --bg-base: #0f172a;
            --bg-surface: rgba(30, 41, 59, 0.7);
            --bg-surface-hover: rgba(30, 41, 59, 0.9);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border-glass: rgba(255, 255, 255, 0.1);
            --shadow-elevation-1: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-elevation-2: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 20px rgba(9, 153, 153, 0.3);

            --font-main: 'Tajawal', system-ui, sans-serif;
            --transition-smooth: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            --transition-bounce: 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        [data-theme="light"] {
            --bg-base: #f1f5f9;
            --bg-surface: rgba(255, 255, 255, 0.8);
            --bg-surface-hover: rgba(255, 255, 255, 1);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-glass: rgba(0, 0, 0, 0.05);
            --shadow-glow: 0 0 20px rgba(9, 153, 153, 0.15);
        }

        /* === Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© === */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg-base);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color var(--transition-smooth), color var(--transition-smooth);
            display: flex; flex-direction: column; align-items: center;
            padding: 2rem 1rem; line-height: 1.6;
        }

        /* === Ø§Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© === */
        .ambient-bg {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: radial-gradient(circle at 15% 50%, rgba(9, 153, 153, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 85% 30%, rgba(251, 191, 36, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }
        .mandala-decoration {
            position: fixed; width: 450px; height: 450px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cg fill='none' stroke='%23099999' stroke-width='1.2'%3E%3Crect x='25' y='25' width='50' height='50' /%3E%3Crect x='25' y='25' width='50' height='50' transform='rotate(45 50 50)' /%3E%3Ccircle cx='50' cy='50' r='15' /%3E%3Ccircle cx='50' cy='50' r='40' stroke='%23fbbf24' stroke-width='0.8' stroke-dasharray='2,3' /%3E%3Cpath d='M50 0 L55 35 L100 50 L55 65 L50 100 L45 65 L0 50 L45 35 Z' fill='%23099999' fill-opacity='0.05' /%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat; background-size: contain; opacity: 0.15; z-index: -1;
            animation: spin-slow 90s linear infinite;
        }
        .mandala-top-right { top: -150px; right: -150px; }
        .mandala-bottom-left { bottom: -150px; left: -150px; }
        @keyframes spin-slow { 100% { transform: rotate(360deg); } }

        /* === ØªØ®Ø·ÙŠØ· Ø§Ù„Ø´Ø¨ÙƒØ© === */
        .dashboard-container {
            width: 100%; max-width: 1280px; display: grid; grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem; opacity: 0; transform: translateY(20px);
        }

        .app-header { grid-column: span 12; display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .greeting-title { font-size: clamp(1.8rem, 4vw, 2.5rem); font-weight: 900; }
        .encouraging-text { font-size: 1.1rem; color: var(--text-secondary); font-weight: 500; }

        .controls { display: flex; gap: 10px; align-items: center; }
        .icon-btn {
            background: var(--bg-surface); border: 1px solid var(--border-glass); color: var(--text-primary);
            width: 44px; height: 44px; border-radius: 12px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-size: 1.2rem; transition: all var(--transition-smooth);
        }
        .icon-btn:hover { background: var(--bg-surface-hover); border-color: var(--brand-primary); transform: translateY(-2px); }

        .streak-pill {
            background: var(--bg-surface); border: 1px solid var(--border-glass); padding: 8px 16px;
            border-radius: 30px; font-size: 0.95rem; font-weight: 700; color: var(--brand-primary);
            display: flex; align-items: center; gap: 6px; box-shadow: var(--shadow-elevation-1);
        }

        /* === Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Cards) === */
        .card {
            background: var(--bg-surface); backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass); border-radius: 24px; padding: 1.5rem;
            box-shadow: var(--shadow-elevation-1); transition: all var(--transition-smooth);
            position: relative; overflow: hidden; content-visibility: auto; contain-intrinsic-size: 200px;
        }
        .card:hover { transform: translateY(-4px); box-shadow: var(--shadow-elevation-2); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.2rem; }
        .card-title { font-size: 1.25rem; font-weight: 700; color: var(--text-secondary); }
        .big-number { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; line-height: 1.1; font-variant-numeric: tabular-nums; }
        .gold-text { color: var(--accent-gold); text-shadow: 0 0 15px rgba(251, 191, 36, 0.2); }
        .brand-text { color: var(--brand-primary); text-shadow: 0 0 15px rgba(9, 153, 153, 0.3); }

        /* Ø§Ù„ØªÙˆØ²ÙŠØ¹ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ© */
        .widget-container { grid-column: span 12; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .main-stat-card { grid-column: span 12; @media(min-width: 992px) { grid-column: span 5; } display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .progress-card { grid-column: span 12; @media(min-width: 992px) { grid-column: span 7; } display: flex; flex-direction: column; justify-content: center; }
        .prayers-list-card, .work-card { grid-column: span 12; @media(min-width: 992px) { grid-column: span 6; } }

        /* === Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØªÙ‚Ø¯Ù… === */
        .progress-wrapper { margin-top: 1rem; width: 100%; }
        .progress-header { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem; }
        .progress-track { width: 100%; height: 14px; background: rgba(0,0,0,0.1); border-radius: 999px; overflow: hidden; border: 1px inset var(--border-glass); }
        [data-theme="light"] .progress-track { background: rgba(0,0,0,0.05); }
        .progress-fill { height: 100%; border-radius: 999px; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        .fill-fasting { background: linear-gradient(90deg, var(--brand-primary), var(--accent-gold)); background-size: 200% 200%; animation: gradientMove 3s ease infinite; }
        .fill-work { background: linear-gradient(90deg, #059669, #34d399); }
        @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* === Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙ„ÙˆØ§Øª === */
        .prayer-item {
            display: flex; justify-content: space-between; padding: 1rem;
            border-bottom: 1px solid var(--border-glass); border-radius: 12px; transition: all 0.3s ease; position: relative;
        }
        .prayer-item:last-child { border-bottom: none; }
        .prayer-item.active { background: rgba(9, 153, 153, 0.1); border-color: transparent; box-shadow: inset -4px 0 0 var(--brand-primary); }
        .prayer-item.active::before {
            content: ''; position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            width: 8px; height: 8px; background: var(--brand-primary); border-radius: 50%;
            animation: pulseDot 2s infinite;
        }
        @keyframes pulseDot { 0% { box-shadow: 0 0 0 0 rgba(9, 153, 153, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(9, 153, 153, 0); } 100% { box-shadow: 0 0 0 0 rgba(9, 153, 153, 0); } }

        /* === Ù‚Ø³Ù… ÙˆÙØ±Ø¯ Ø§Ù„Ù†Ø´Ø§Ù…Ù‰ (Ø§Ù„Ù…Ø³Ø¨Ø­Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©) === */
        .wird-section { grid-column: span 12; margin-top: 2rem; border-top: 1px solid var(--border-glass); padding-top: 2rem; }
        .wird-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; }
        
        .dhikr-card {
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            padding: 2rem 1.5rem; text-align: center; cursor: pointer;
        }
        .dhikr-title { font-size: 1.4rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem; }
        .dhikr-meta { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1.5rem; }

        .ring-container {
            position: relative; width: 180px; height: 180px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; transition: transform 0.1s var(--transition-bounce);
        }
        .dhikr-card:active .ring-container { transform: scale(0.95); }
        
        .ring-svg { transform: rotate(-90deg); width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        .ring-bg { fill: none; stroke: var(--border-glass); stroke-width: 8; }
        .ring-fg {
            fill: none; stroke: var(--brand-primary); stroke-width: 8; stroke-linecap: round;
            stroke-dasharray: 502; stroke-dashoffset: 502;
            transition: stroke-dashoffset 0.4s var(--transition-smooth); filter: drop-shadow(0 0 6px var(--shadow-glow));
        }
        .ring-content { position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center; pointer-events: none; }
        .ring-count { font-size: 3rem; font-weight: 900; color: var(--text-primary); line-height: 1; }
        .ring-hint { font-size: 0.85rem; color: var(--text-secondary); margin-top: 5px; }

        /* === Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ === */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: all var(--transition-smooth);
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--bg-base); width: 90%; max-width: 450px; padding: 2.5rem;
            border-radius: 24px; border: 1px solid var(--border-glass);
            transform: scale(0.95) translateY(20px); transition: all var(--transition-bounce);
        }
        .modal-overlay.active .modal-content { transform: scale(1) translateY(0); }
        
        .form-group { margin-bottom: 1.5rem; text-align: right; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-secondary); }
        .form-control {
            width: 100%; padding: 0.8rem 1rem; border-radius: 12px; background: var(--bg-surface);
            border: 2px solid var(--border-glass); color: var(--text-primary); font-family: var(--font-main); font-size: 1rem;
        }
        .form-control:focus { outline: none; border-color: var(--brand-primary); }
        
        .btn-primary {
            width: 100%; padding: 1rem; border-radius: 12px; border: none; background: var(--brand-primary);
            color: #fff; font-family: var(--font-main); font-size: 1.1rem; font-weight: 700; cursor: pointer;
            transition: all var(--transition-bounce);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-glow); }

        /* Skeletons & Toasts */
        .toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: var(--bg-surface-hover); color: var(--text-primary); padding: 12px 24px; border-radius: 99px; box-shadow: var(--shadow-elevation-2); border: 1px solid var(--border-glass); animation: slideUpFade 0.4s forwards; }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .skeleton { background: linear-gradient(90deg, var(--bg-surface) 25%, var(--border-glass) 50%, var(--bg-surface) 75%); background-size: 400% 100%; animation: skeleton-loading 1.5s infinite; border-radius: 8px; color: transparent !important; user-select: none; }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    </style>
</head>
<body>

    <div class="ambient-bg"></div>
    <div class="mandala-decoration mandala-top-right"></div>
    <div class="mandala-decoration mandala-bottom-left"></div>
    <div id="toast-container" class="toast-container"></div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="card-title brand-text" style="justify-content:center; font-size:1.5rem; margin-bottom:2rem;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ¬Ø±Ø¨Ø©</h2>
            <form id="settings-form">
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù„Ù‚Ø¨</label>
                    <input type="text" id="user-name-input" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" required>
                </div>
                <div class="form-group">
                    <label>ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ§Ù…</label>
                    <input type="time" id="start-time-input" class="form-control" value="07:30" required>
                </div>
                <div class="form-group">
                    <label>ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…</label>
                    <input type="time" id="end-time-input" class="form-control" value="14:30" required>
                </div>
                <button type="submit" class="btn-primary">Ø­ÙØ¸ ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ¬Ø±Ø¨Ø©</button>
            </form>
        </div>
    </div>

    <main class="dashboard-container" id="main-dashboard">
        
        <header class="app-header">
            <div>
                <h1 class="greeting-title">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ<span id="display-name" class="brand-text"></span> âœ¨</h1>
                <p id="encouraging-message" class="encouraging-text skeleton">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
            <div class="controls">
                <div class="streak-pill" title="Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© Ù„Ù„ÙˆÙØ±Ø¯">ğŸ”¥ <span id="streak-disp">0</span></div>
                <button id="theme-toggle" class="icon-btn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±">ğŸŒ™</button>
                <button id="settings-trigger" class="icon-btn" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">âš™ï¸</button>
            </div>
        </header>

        <section class="widget-container">
            <div class="card">
                <div class="card-title" style="font-size:0.9rem; justify-content:center;">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</div>
                <div id="hijri-date" class="big-number gold-text skeleton" style="font-size:1.8rem; text-align:center; margin-top:10px;">ØªØ­Ù…ÙŠÙ„...</div>
            </div>
            <div class="card">
                <div class="card-title" style="font-size:0.9rem; justify-content:center;">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</div>
                <div id="gregorian-date" class="big-number skeleton" style="font-size:1.5rem; text-align:center; margin-top:10px;">ØªØ­Ù…ÙŠÙ„...</div>
            </div>
            <div class="card">
                <div class="card-title" style="font-size:0.9rem; justify-content:center;">Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¹ÙŠØ¯</div>
                <div id="days-left" class="big-number brand-text skeleton" style="font-size:1.8rem; text-align:center; margin-top:10px;">-</div>
            </div>
        </section>

        <article class="card main-stat-card">
            <h2 class="card-title">Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: <span id="next-prayer-name" class="brand-text skeleton" style="margin-right:8px;">-</span></h2>
            <div id="countdown" class="big-number gold-text skeleton">00:00:00</div>
            <p class="encouraging-text" style="margin-top:5px;">Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø£Ø°Ø§Ù†</p>
        </article>

        <article class="card progress-card">
            <h2 class="card-title">â³ Ø±Ø­Ù„Ø© Ø§Ù„ØµÙŠØ§Ù… Ø§Ù„ÙŠÙˆÙ…</h2>
            <div class="progress-wrapper">
                <div class="progress-header"><span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span><span id="fasting-percentage" class="progress-value brand-text skeleton">0.00%</span></div>
                <div class="progress-track"><div id="fasting-bar" class="progress-fill fill-fasting" style="width:0%;"></div></div>
            </div>
        </article>

        <article class="card prayers-list-card">
            <h2 class="card-title">ğŸ•Œ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h2>
            <div id="prayers-list" style="margin-top:1rem; display:flex; flex-direction:column; gap:8px;">
                <div class="prayer-item skeleton" style="height:50px;"></div>
                <div class="prayer-item skeleton" style="height:50px;"></div>
            </div>
        </article>

        <article class="card work-card">
            <h2 class="card-title">ğŸ“Š ØªØªØ¨Ø¹ Ø§Ù„Ø¯ÙˆØ§Ù… <span style="font-size:0.8rem; font-weight:normal; margin-right:auto; color:var(--text-secondary);" id="work-hours-display"></span></h2>
            <div style="text-align:center; margin:1rem 0;">
                <div id="work-countdown" class="big-number skeleton" style="font-size:2.5rem; color:var(--success-color);">00:00:00</div>
                <p id="work-status-label" class="encouraging-text skeleton">Ø§Ù„Ø­Ø§Ù„Ø©</p>
            </div>
            <div class="progress-wrapper">
                <div class="progress-header"><span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</span><span id="work-percentage" class="progress-value skeleton" style="color:var(--success-color);">0.00%</span></div>
                <div class="progress-track"><div id="work-bar" class="progress-fill fill-work" style="width:0%;"></div></div>
            </div>
        </article>

        <section class="wird-section">
            <div class="card-header">
                <h2 class="card-title" style="font-size: 1.8rem;">ğŸ“¿ ÙˆÙØ±Ø¯ Ø§Ù„Ù†Ø´Ø§Ù…Ù‰ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
                <div class="encouraging-text" style="font-size: 0.95rem;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø°ÙƒØ§Ø±: <span id="total-dhikr-disp" class="brand-text" style="font-weight:bold;">0</span></div>
            </div>
            <div id="wird-container" class="wird-grid">
                </div>
        </section>

    </main>

    <script>
        const AppCore = (() => {
            // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© ===
            const state = {
                user: { name: '', startWork: '07:30', endWork: '14:30' },
                theme: 'dark', coords: null, calcParams: null, nextPrayerTime: null, isDataLoaded: false,
                wird: { 
                    streak: 0, lastLog: null, total: 0, history: {},
                    tasks: [
                        { id: 't1', text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù', target: 33, count: 0 },
                        { id: 't2', text: 'Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù', target: 100, count: 0 },
                        { id: 't3', text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù', target: 10, count: 0 },
                        { id: 't4', text: 'Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù', target: 100, count: 0 }
                    ]
                }
            };

            const DOM = {
                app: document.getElementById('main-dashboard'), modal: document.getElementById('settings-modal'), form: document.getElementById('settings-form'),
                toastContainer: document.getElementById('toast-container'), themeToggle: document.getElementById('theme-toggle'), settingsTrigger: document.getElementById('settings-trigger'), wirdContainer: document.getElementById('wird-container')
            };

            // === Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© Ù„Ù„Ù…Ø³Ø¨Ø­Ø© ===
            const AudioFX = {
                ctx: null,
                playPop(pitch) {
                    try {
                        if (!this.ctx) { window.AudioContext = window.AudioContext || window.webkitAudioContext; this.ctx = new AudioContext(); }
                        if (this.ctx.state === 'suspended') this.ctx.resume();
                        const o = this.ctx.createOscillator(), g = this.ctx.createGain();
                        o.frequency.setValueAtTime(300 * pitch, this.ctx.currentTime); o.frequency.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.15);
                        g.gain.setValueAtTime(0.3, this.ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.1);
                        o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime + 0.15);
                    } catch(e) {}
                }
            };

            const Utils = {
                showToast: (msg, type='info') => {
                    const t = document.createElement('div'); t.className = 'toast'; t.textContent = msg;
                    if(type === 'error') t.style.borderRight = '4px solid var(--danger-color)';
                    if(type === 'success') t.style.borderRight = '4px solid var(--success-color)';
                    DOM.toastContainer.appendChild(t); setTimeout(() => { t.style.animation = 'slideUpFade 0.4s reverse forwards'; setTimeout(() => t.remove(), 400); }, 3000);
                },
                formatTimeDiff: (ms) => {
                    if(ms <= 0) return "00:00:00";
                    const h = Math.floor(ms / 3600000).toString().padStart(2, '0'), m = Math.floor((ms % 3600000) / 60000).toString().padStart(2, '0'), s = Math.floor((ms % 60000) / 1000).toString().padStart(2, '0');
                    return `${h}:${m}:${s}`;
                }
            };

            // === Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø°ÙƒØ§Ø± (ÙˆÙØ±Ø¯) ===
            const WirdLogic = {
                init() {
                    const s = localStorage.getItem('ramadan_wird_data');
                    if(s) state.wird = JSON.parse(s);
                    this.checkDate(); this.render(); this.updateStats();
                },
                save() { localStorage.setItem('ramadan_wird_data', JSON.stringify(state.wird)); },
                checkDate() {
                    const today = new Date().toISOString().split('T')[0];
                    if (state.wird.lastLog !== today) {
                        state.wird.tasks.forEach(x => x.count = 0);
                        state.wird.lastLog = today; this.save();
                    }
                },
                render() {
                    DOM.wirdContainer.innerHTML = '';
                    state.wird.tasks.forEach(t => {
                        const el = document.createElement('div'); el.className = 'card dhikr-card';
                        el.onclick = () => this.tap(t.id);
                        el.innerHTML = `
                            <div><div class="dhikr-title">${t.text}</div><div class="dhikr-meta">Ø§Ù„Ù‡Ø¯Ù: ${t.target}</div></div>
                            <div class="ring-container">
                                <svg class="ring-svg" viewBox="0 0 180 180">
                                    <circle class="ring-bg" cx="90" cy="90" r="80"></circle>
                                    <circle class="ring-fg" id="ring-${t.id}" cx="90" cy="90" r="80"></circle>
                                </svg>
                                <div class="ring-content"><div class="ring-count" id="count-${t.id}">${t.target - t.count}</div><div class="ring-hint">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø¯</div></div>
                            </div>
                        `;
                        DOM.wirdContainer.appendChild(el);
                        this.updateRingUI(t.id, t.count, t.target);
                    });
                },
                tap(id) {
                    const t = state.wird.tasks.find(x => x.id === id);
                    if (t.count < t.target) {
                        t.count++; state.wird.total++;
                        const today = new Date().toISOString().split('T')[0];
                        if(!state.wird.history[today]) { state.wird.history[today] = 1; state.wird.streak++; } 
                        else state.wird.history[today]++;
                        this.save(); this.updateRingUI(id, t.count, t.target); this.updateStats();
                        AudioFX.playPop(1 + (t.count/t.target));
                        if(navigator.vibrate) navigator.vibrate(10);
                    }
                },
                updateRingUI(id, count, target) {
                    const ring = document.getElementById(`ring-${id}`), num = document.getElementById(`count-${id}`);
                    const radius = 80; const circumference = 2 * Math.PI * radius; // 502
                    ring.style.strokeDasharray = circumference;
                    ring.style.strokeDashoffset = circumference * (1 - count/target);
                    if (count >= target) { num.innerText = "âœ¨"; ring.style.stroke = "var(--success-color)"; } 
                    else { num.innerText = target - count; ring.style.stroke = "var(--brand-primary)"; }
                },
                updateStats() {
                    document.getElementById('streak-disp').innerText = state.wird.streak;
                    document.getElementById('total-dhikr-disp').innerText = state.wird.total;
                }
            };

            // === Ù…Ù†Ø·Ù‚ Ù„ÙˆØ­Ø© Ø±Ù…Ø¶Ø§Ù† ===
            const DashboardLogic = {
                initAdhan() {
                    if (typeof adhan === 'undefined') return false;
                    state.coords = new adhan.Coordinates(31.9539, 35.9106); // Ø¹Ù…Ø§Ù†
                    state.calcParams = adhan.CalculationMethod.MuslimWorldLeague();
                    state.calcParams.fajrAngle = 18; state.calcParams.ishaAngle = 18; state.calcParams.madhab = adhan.Madhab.Shafi;
                    return true;
                },
                updateStatic() {
                    const now = new Date();
                    try { document.getElementById('hijri-date').textContent = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {day:'numeric', month:'long', year:'numeric'}).format(now).replace('Ù‡Ù€','').trim(); } catch(e){}
                    try { document.getElementById('gregorian-date').textContent = new Intl.DateTimeFormat('ar-JO', {weekday:'long', day:'numeric', month:'short'}).format(now); } catch(e){}
                    const endRamadan = new Date('2026-03-21T00:00:00');
                    const diffDays = Math.ceil((endRamadan - now) / 86400000);
                    document.getElementById('days-left').textContent = diffDays > 0 ? `${diffDays} ÙŠÙˆÙ…` : 'Ø¹ÙŠØ¯ Ø³Ø¹ÙŠØ¯!';
                },
                renderPrayers(pt) {
                    const list = document.getElementById('prayers-list'); list.innerHTML = '';
                    const sched = [{id:'fajr', n:'Ø§Ù„ÙØ¬Ø±', t:pt.fajr}, {id:'sunrise', n:'Ø§Ù„Ø´Ø±ÙˆÙ‚', t:pt.sunrise}, {id:'dhuhr', n:'Ø§Ù„Ø¸Ù‡Ø±', t:pt.dhuhr}, {id:'asr', n:'Ø§Ù„Ø¹ØµØ±', t:pt.asr}, {id:'maghrib', n:'Ø§Ù„Ù…ØºØ±Ø¨', t:pt.maghrib}, {id:'isha', n:'Ø§Ù„Ø¹Ø´Ø§Ø¡', t:pt.isha}];
                    const now = new Date(); let nextFound = false;
                    sched.forEach(p => {
                        const d = document.createElement('div'); d.className = 'prayer-item';
                        if (!nextFound && p.t > now && p.id !== 'sunrise') { d.classList.add('active'); nextFound = true; document.getElementById('next-prayer-name').textContent = p.n; state.nextPrayerTime = p.t; }
                        d.innerHTML = `<span>${p.n}</span><span style="font-family:monospace; font-weight:bold;">${p.t.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:false})}</span>`;
                        list.appendChild(d);
                    });
                    if (!nextFound) { state.nextPrayerTime = new adhan.PrayerTimes(state.coords, new Date(now.getTime()+86400000), state.calcParams).fajr; document.getElementById('next-prayer-name').textContent = 'ÙØ¬Ø± Ø§Ù„ØºØ¯'; }
                },
                tick() {
                    if (!state.isDataLoaded) return;
                    const now = new Date(), pt = new adhan.PrayerTimes(state.coords, now, state.calcParams);
                    
                    // 1. Next Prayer
                    if (state.nextPrayerTime) {
                        const diff = state.nextPrayerTime - now;
                        if (diff > 0) document.getElementById('countdown').textContent = Utils.formatTimeDiff(diff);
                        else DashboardLogic.renderPrayers(pt);
                    }
                    
                    // 2. Fasting
                    const f = pt.fajr, m = pt.maghrib;
                    if (now >= f && now <= m) {
                        const p = ((now - f) / (m - f)) * 100;
                        document.getElementById('fasting-percentage').textContent = p.toFixed(2) + '%';
                        document.getElementById('fasting-bar').style.width = p + '%';
                        document.getElementById('encouraging-message').textContent = p < 50 ? "Ø¨Ø¯Ø§ÙŠØ© ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø¬Ø± ğŸ’ª" : "Ø§Ù‚ØªØ±Ø¨ Ø§Ù„Ù…ÙˆØ¹Ø¯.. Ø¬Ù‡Ù‘Ø² Ø¯Ø¹ÙˆØ§ØªÙƒ ğŸ¤²";
                    } else {
                        document.getElementById('fasting-percentage').textContent = now < f ? '0%' : '100%';
                        document.getElementById('fasting-bar').style.width = now < f ? '0%' : '100%';
                        document.getElementById('encouraging-message').textContent = now < f ? "Ù„Ø§ ØªÙ†Ø³Ù Ø§Ù„Ø³Ø­ÙˆØ± ğŸŒ™" : "ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ ØµÙŠØ§Ù…Ùƒ âœ¨";
                    }

                    // 3. Work
                    const d = now.getDay();
                    if(d===5 || d===6) {
                        document.getElementById('work-countdown').textContent = "Ø¥Ø¬Ø§Ø²Ø©"; document.getElementById('work-status-label').textContent = "Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹";
                    } else {
                        const [sH, sM] = state.user.startWork.split(':'), [eH, eM] = state.user.endWork.split(':');
                        const wStart = new Date(now).setHours(sH, sM, 0, 0), wEnd = new Date(now).setHours(eH, eM, 0, 0);
                        if(now >= wStart && now <= wEnd) {
                            const p = ((now - wStart) / (wEnd - wStart)) * 100;
                            document.getElementById('work-countdown').textContent = Utils.formatTimeDiff(wEnd - now);
                            document.getElementById('work-percentage').textContent = p.toFixed(2) + '%';
                            document.getElementById('work-bar').style.width = p + '%';
                            document.getElementById('work-status-label').textContent = "Ù…ØªØ¨Ù‚ÙŠ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù…";
                        } else {
                            document.getElementById('work-countdown').textContent = now < wStart ? Utils.formatTimeDiff(wStart - now) : "00:00:00";
                            document.getElementById('work-status-label').textContent = now < wStart ? "Ù‚Ø¨Ù„ Ø§Ù„Ø¯ÙˆØ§Ù…" : "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¯ÙˆØ§Ù…";
                            document.getElementById('work-bar').style.width = now > wEnd ? '100%' : '0%';
                        }
                    }
                    requestAnimationFrame(DashboardLogic.tick);
                }
            };

            // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… ===
            const UI = {
                initTheme() {
                    state.theme = localStorage.getItem('ramadan_theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
                    this.applyTheme();
                    DOM.themeToggle.onclick = () => { state.theme = state.theme === 'dark' ? 'light' : 'dark'; localStorage.setItem('ramadan_theme', state.theme); this.applyTheme(); };
                },
                applyTheme() { document.documentElement.setAttribute('data-theme', state.theme); DOM.themeToggle.textContent = state.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'; },
                initSettings() {
                    const saved = localStorage.getItem('ramadan_user');
                    if(saved) { state.user = JSON.parse(saved); this.applyUserData(); this.startApp(); } else { DOM.modal.classList.add('active'); }
                    DOM.settingsTrigger.onclick = () => DOM.modal.classList.add('active');
                    DOM.form.onsubmit = (e) => {
                        e.preventDefault();
                        state.user = { name: document.getElementById('user-name-input').value, startWork: document.getElementById('start-time-input').value, endWork: document.getElementById('end-time-input').value };
                        localStorage.setItem('ramadan_user', JSON.stringify(state.user));
                        this.applyUserData(); DOM.modal.classList.remove('active'); Utils.showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        if(!state.isDataLoaded) this.startApp();
                    };
                },
                applyUserData() {
                    document.getElementById('display-name').textContent = `ØŒ ${state.user.name}`;
                    document.getElementById('work-hours-display').textContent = `(${state.user.startWork} - ${state.user.endWork})`;
                    document.getElementById('user-name-input').value = state.user.name;
                    document.getElementById('start-time-input').value = state.user.startWork;
                    document.getElementById('end-time-input').value = state.user.endWork;
                },
                startApp() {
                    let attempts = 0;
                    const chk = setInterval(() => {
                        if (DashboardLogic.initAdhan()) {
                            clearInterval(chk); DashboardLogic.updateStatic();
                            DashboardLogic.renderPrayers(new adhan.PrayerTimes(state.coords, new Date(), state.calcParams));
                            document.querySelectorAll('.skeleton').forEach(el => el.classList.remove('skeleton'));
                            DOM.app.style.opacity = '1'; DOM.app.style.transform = 'translateY(0)';
                            state.isDataLoaded = true;
                            WirdLogic.init(); // Ø¨Ø¯Ø¡ Ø§Ù„Ø£Ø°ÙƒØ§Ø±
                            requestAnimationFrame(DashboardLogic.tick);
                        } else if(attempts++ > 5) { clearInterval(chk); document.getElementById('encouraging-message').textContent = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; }
                    }, 500);
                }
            };

            return { init: () => { UI.initTheme(); UI.initSettings(); } };
        })();

        document.addEventListener('DOMContentLoaded', AppCore.init);
    </script>
</body>
</html>
